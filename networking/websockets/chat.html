<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Chat App</title>
    <style>
      body {
        font-family: sans-serif;
        max-width: 800px; /* make wider for more room */
        margin: 2em auto;
      }

      #profile-bar {
        margin-bottom: 20px;
        font-weight: bold;
        font-size: 1.1em;
      }

      #main {
        display: flex;
        gap: 30px; /* space between chat and user list */
      }

      #chat-area,
      #user-list-area {
        display: flex;
        flex-direction: column;
      }

      #chat-area {
        flex: 2;
      }

      #user-list-area {
        flex: 1;
      }

      #messages {
        height: 400px; /* fixed height */
        border: 1px solid #ccc;
        padding: 10px;
        overflow-y: auto; /* scrolls when content exceeds height */
      }

      #user-list {
        height: 400px; /* match messages for symmetry */
        border: 1px solid #ccc;
        padding: 10px;
        overflow-y: auto;
      }

      #inputArea {
        display: flex;
        margin-top: 10px;
      }

      #msg {
        flex: 1;
        padding: 5px;
      }

      button {
        padding: 5px 10px;
      }
    </style>
  </head>
  <body>
    <div style="display: flex; gap: 20px; flex-direction: row">
      <!-- Top bar showing logged-in user -->
      <div style="margin-bottom: 10px; font-weight: bold">
        Logged in as: <span id="profile-name"></span>
      </div>

      <!-- Left: Chat area -->
      <div style="flex: 2">
        <h2>Chat</h2>
        <div id="connected">Currently connected: 0</div>
        <div id="messages"></div>
        <div id="inputArea">
          <input id="msg" placeholder="Type a message..." />
          <button onclick="sendMsg()">Send</button>
        </div>
      </div>

      <!-- Right: User list -->
      <div style="flex: 1">
        <h2>Users</h2>
        <div id="user-list-description">List of users</div>
        <div id="user-list"></div>
      </div>
    </div>

    <script>
      const username = prompt("Enter your name:") || "Anonymous";
      document.getElementById("profile-name").textContent = username;

      const socket = new WebSocket("ws://localhost:8765");
      const messagesDiv = document.getElementById("messages");
      const connectedDiv = document.getElementById("connected");
      const userListDiv = document.getElementById("user-list");
      const userListDescriptionDiv = document.getElementById(
        "user-list-description"
      );

      // Join message
      socket.onopen = () => {
        socket.send(JSON.stringify({ type: "join", username }));
      };

      // Listen to all messages from backend
      socket.onmessage = (event) => {
        const data = JSON.parse(event.data);
        if (data.type === "message") addMsg(data.text);
        if (data.type === "userlist") updateUserList(data.users);
      };

      socket.onclose = () => {
        addMsg("ðŸ”´ Connection closed");
      };

      function sendMsg() {
        const input = document.getElementById("msg");
        const text = input.value.trim();
        if (!text) return;

        socket.send(
          JSON.stringify({ type: "message", text: `${username}: ${text}` })
        );
        input.value = "";
      }

      function addMsg(text) {
        const div = document.createElement("div");
        div.textContent = text;
        // Optional: color join/leave messages
        if (text.startsWith("ðŸŸ¢")) div.style.color = "green";
        if (text.startsWith("ðŸ”´")) div.style.color = "red";
        messagesDiv.appendChild(div);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }

      function updateUserList(users) {
        userListDiv.innerHTML = "";
        users.forEach((user) => {
          const div = document.createElement("div");
          div.textContent = user;
          userListDiv.appendChild(div);
        });
        connectedDiv.textContent = `Currently connected: ${users.length}`;
        userListDescriptionDiv.textContent =
          users.length === 1
            ? "1 user connected"
            : `${users.length} users connected`;
      }

      document.getElementById("msg").addEventListener("keydown", (e) => {
        if (e.key === "Enter") sendMsg();
      });
    </script>
  </body>
</html>
